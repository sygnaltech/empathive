{
  "version": 3,
  "sources": ["../../src/page/pre-apply.ts"],
  "sourcesContent": ["\n/** \n * Page | Pre-Application\n * \n * https://codepen.io/memetican/pen/yLrPGYQ/3eab16e69849194fc44b47213d764241\n */\n\nimport { IRouteHandler } from \"@sygnal/sse\";\n \n\nexport class PreApplicationPage implements IRouteHandler {\n\n  constructor() {\n  }\n\n  setup() {\n        \n  }\n\n  exec() {\n\n    console.log(\"running pre-appl..\")\n\n    const div = document.getElementById('pre-application');\n    if (!div) {\n      console.error(\"Div with ID 'pre-application' not found.\");\n      return;\n    }\n\n    const form = div.querySelector('form') as HTMLFormElement | null;\n    if (!form) {\n      console.error(\"Form inside 'pre-application' div not found.\");\n      return;\n    }\n\n    form.addEventListener('submit', this.handleFormSubmit.bind(this));\n\n  }\n\n\n\n  /**\n   * Handles the display of the wait button and hides the actual button.\n   * @param formElement - The form element containing the buttons.\n   */\n  private waitButton(formElement: HTMLFormElement): void {\n    console.log(\"display waitButton\");\n\n    // Locate the \"actual\" button and hide it\n    const actualButton = formElement.querySelector('[button-submit=\"actual\"]') as HTMLElement | null;\n    if (actualButton) {\n      actualButton.style.display = 'none';\n    }\n\n    // Locate the \"wait\" button and show it as block\n    const waitButton = formElement.querySelector('[button-submit=\"wait\"]') as HTMLElement | null;\n    if (waitButton) {\n      waitButton.style.display = 'block';\n    }\n  }\n\n  /**\n   * Handles the form submission event.\n   * @param event - The form submission event.\n   */\n  private handleFormSubmit(event: Event): void {\n    event.preventDefault(); // Prevent the default form submission\n  \n    const form = event.target as HTMLFormElement;\n    this.waitButton(form);\n  \n    console.log(\"formdata\", form);\n  \n    const formData = new FormData(form);\n  \n    // Convert FormData to an object manually\n    const jsonData: { [key: string]: FormDataEntryValue } = {};\n    formData.forEach((value, key) => {\n      jsonData[key] = value;\n    });\n  \n    // data-redirect\n    const redirectUrl = form.getAttribute('data-redirect') || '';\n    const webhookUrl = form.getAttribute('action') || '';\n  \n    console.log(jsonData);\n  \n    // Send the form data to the webhook URL\n    fetch(webhookUrl, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(jsonData),\n    })\n      .then(response => {\n        if (!response.ok) {\n          throw new Error(`Network response was not ok: ${response.statusText}`);\n        }\n        return response.json();\n      })\n      .then(data => {\n        // Assuming 'id' is the key in the response that holds the needed ID\n        if (data && data.id) {\n          // Store the ID in localStorage\n          console.log(data.id);\n          localStorage.setItem('customerId', data.id);\n  \n          // Redirect the user\n          if (redirectUrl) {\n            window.location.href = redirectUrl;\n          }\n        } else {\n          // Handle the error if the response doesn't include an ID\n          console.error('ID was not returned from the webhook.');\n        }\n      })\n      .catch(error => {\n        // Handle any errors that occurred during the fetch\n        console.error('Error submitting form to webhook:', error);\n      });\n  }\n  \n}\n"],
  "mappings": ";;;AAUO,MAAM,qBAAN,MAAkD;AAAA,IAEvD,cAAc;AAAA,IACd;AAAA,IAEA,QAAQ;AAAA,IAER;AAAA,IAEA,OAAO;AAEL,cAAQ,IAAI,oBAAoB;AAEhC,YAAM,MAAM,SAAS,eAAe,iBAAiB;AACrD,UAAI,CAAC,KAAK;AACR,gBAAQ,MAAM,0CAA0C;AACxD;AAAA,MACF;AAEA,YAAM,OAAO,IAAI,cAAc,MAAM;AACrC,UAAI,CAAC,MAAM;AACT,gBAAQ,MAAM,8CAA8C;AAC5D;AAAA,MACF;AAEA,WAAK,iBAAiB,UAAU,KAAK,iBAAiB,KAAK,IAAI,CAAC;AAAA,IAElE;AAAA,IAQQ,WAAW,aAAoC;AACrD,cAAQ,IAAI,oBAAoB;AAGhC,YAAM,eAAe,YAAY,cAAc,0BAA0B;AACzE,UAAI,cAAc;AAChB,qBAAa,MAAM,UAAU;AAAA,MAC/B;AAGA,YAAM,aAAa,YAAY,cAAc,wBAAwB;AACrE,UAAI,YAAY;AACd,mBAAW,MAAM,UAAU;AAAA,MAC7B;AAAA,IACF;AAAA,IAMQ,iBAAiB,OAAoB;AAC3C,YAAM,eAAe;AAErB,YAAM,OAAO,MAAM;AACnB,WAAK,WAAW,IAAI;AAEpB,cAAQ,IAAI,YAAY,IAAI;AAE5B,YAAM,WAAW,IAAI,SAAS,IAAI;AAGlC,YAAM,WAAkD,CAAC;AACzD,eAAS,QAAQ,CAAC,OAAO,QAAQ;AAC/B,iBAAS,OAAO;AAAA,MAClB,CAAC;AAGD,YAAM,cAAc,KAAK,aAAa,eAAe,KAAK;AAC1D,YAAM,aAAa,KAAK,aAAa,QAAQ,KAAK;AAElD,cAAQ,IAAI,QAAQ;AAGpB,YAAM,YAAY;AAAA,QAChB,QAAQ;AAAA,QACR,SAAS;AAAA,UACP,gBAAgB;AAAA,QAClB;AAAA,QACA,MAAM,KAAK,UAAU,QAAQ;AAAA,MAC/B,CAAC,EACE,KAAK,cAAY;AAChB,YAAI,CAAC,SAAS,IAAI;AAChB,gBAAM,IAAI,MAAM,gCAAgC,SAAS,YAAY;AAAA,QACvE;AACA,eAAO,SAAS,KAAK;AAAA,MACvB,CAAC,EACA,KAAK,UAAQ;AAEZ,YAAI,QAAQ,KAAK,IAAI;AAEnB,kBAAQ,IAAI,KAAK,EAAE;AACnB,uBAAa,QAAQ,cAAc,KAAK,EAAE;AAG1C,cAAI,aAAa;AACf,mBAAO,SAAS,OAAO;AAAA,UACzB;AAAA,QACF,OAAO;AAEL,kBAAQ,MAAM,uCAAuC;AAAA,QACvD;AAAA,MACF,CAAC,EACA,MAAM,WAAS;AAEd,gBAAQ,MAAM,qCAAqC,KAAK;AAAA,MAC1D,CAAC;AAAA,IACL;AAAA,EAEF;",
  "names": []
}
